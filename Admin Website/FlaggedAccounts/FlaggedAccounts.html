<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flagged Accounts - TODA Admin</title>
  <link rel="stylesheet" href="FlaggedAccounts.css">
  <link rel="icon" type="image/png" href="../moto_logo.png">
  <!-- Authentication Check - Must be loaded first -->
  <script src="../auth-check.js"></script>
</head>
<body>
  <div class="page-container">
    <!-- Top Bar -->
    <header class="top-bar">
      <button class="back-btn" onclick="window.location.href='../index.html'">
        <span class="icon">â†</span> 
      </button>
      <div class="page-title">
        <h1>ğŸš© Flagged Accounts</h1>
        <p>Monitor and manage problematic accounts</p>
      </div>
    </header>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card blue">
        <div class="stat-icon">ï¿½</div>
        <div class="stat-details">
          <div class="stat-value" id="totalAccounts">0</div>
          <div class="stat-label">Total Accounts</div>
        </div>
      </div>

      <div class="stat-card red">
        <div class="stat-icon">ğŸš¨</div>
        <div class="stat-details">
          <div class="stat-value" id="suspendedCount">0</div>
          <div class="stat-label">Suspended</div>
        </div>
      </div>

      <div class="stat-card orange">
        <div class="stat-icon">âš ï¸</div>
        <div class="stat-details">
          <div class="stat-value" id="restrictedCount">0</div>
          <div class="stat-label">Restricted</div>
        </div>
      </div>

      <div class="stat-card yellow">
        <div class="stat-icon">ğŸ‘€</div>
        <div class="stat-details">
          <div class="stat-value" id="monitoredCount">0</div>
          <div class="stat-label">Monitored</div>
        </div>
      </div>

      <div class="stat-card green">
        <div class="stat-icon">âœ…</div>
        <div class="stat-details">
          <div class="stat-value" id="goodCount">0</div>
          <div class="stat-label">Good Standing</div>
        </div>
      </div>
    </div>

    <!-- Filters and Actions -->
    <div class="controls-section">
      <div class="filters">
        <select id="accountTypeFilter" onchange="applyFilters()">
          <option value="all">All Accounts</option>
          <option value="driver">Drivers Only</option>
          <option value="customer">Customers Only</option>
        </select>

        <select id="flagStatusFilter" onchange="applyFilters()">
          <option value="all">All Statuses</option>
          <option value="suspended">ğŸš« Suspended (301+ pts)</option>
          <option value="restricted">âš ï¸ Restricted (151-300 pts)</option>
          <option value="monitored">ğŸ‘€ Monitored (51-150 pts)</option>
          <option value="good">âœ… Good Standing (0-50 pts)</option>
        </select>

        <select id="flaggedOnlyFilter" onchange="applyFilters()">
          <option value="all">All Accounts</option>
          <option value="flagged">ğŸš© Flagged Only</option>
          <option value="clean">âœ… Clean Records Only</option>
        </select>

        <input type="text" id="searchInput" placeholder="ğŸ” Search by name, ID, or phone..." oninput="applyFilters()">
      </div>

      <div class="action-buttons">
        <button class="btn-secondary" onclick="exportReport()">
          <span class="icon">ğŸ“¥</span> Export Report
        </button>
        <button class="btn-primary" onclick="runAutoDetection()">
          <span class="icon">ğŸ”</span> Run Auto-Detection
        </button>
      </div>
    </div>

    <!-- All Accounts Table -->
    <div class="table-container">
      <div class="table-header">
        <h2>Account Monitor</h2>
        <div class="table-info">
          <span id="tableCount">0 accounts</span>
        </div>
      </div>

      <div class="table-wrapper">
        <table class="flagged-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Type</th>
              <th>Flag Score</th>
              <th>Status</th>
              <th>Active Flags</th>
              <th>Flag Details</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="flaggedTableBody">
            <tr>
              <td colspan="7" class="loading-row">
                <div class="loading">Loading accounts...</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" id="pagination">
      <button class="page-btn" onclick="changePage(-1)">Previous</button>
      <span class="page-info" id="pageInfo">Page 1 of 1</span>
      <button class="page-btn" onclick="changePage(1)">Next</button>
    </div>
  </div>

  <!-- Flag Details Modal -->
  <div class="modal" id="flagDetailsModal">
    <div class="modal-content large">
      <div class="modal-header">
        <h2>ğŸš© Flag Details</h2>
        <button class="close-btn" onclick="closeFlagDetails()">Ã—</button>
      </div>
      <div class="modal-body" id="flagDetailsContent">
        <!-- Content will be injected by JavaScript -->
      </div>
      <div class="modal-footer">
        <button class="btn-danger" onclick="escalateFlag()">Escalate</button>
        <button class="btn-secondary" onclick="dismissFlag()">Dismiss</button>
        <button class="btn-success" onclick="resolveFlag()">Resolve</button>
        <button class="btn-secondary" onclick="closeFlagDetails()">Close</button>
      </div>
    </div>
  </div>

  <!-- Auto-Detection Progress Modal -->
  <div class="modal" id="detectionModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ” Running Auto-Detection</h2>
      </div>
      <div class="modal-body">
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-text" id="progressText">Initializing...</div>
        </div>
        <div class="detection-results" id="detectionResults"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeDetectionModal()" id="closeDetectionBtn" disabled>Close</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal" id="confirmModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="confirmTitle">âš ï¸ Confirm Action</h2>
      </div>
      <div class="modal-body">
        <p id="confirmMessage"></p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeConfirmModal()">Cancel</button>
        <button class="btn-primary" id="confirmBtn" onclick="handleConfirm()">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Account Details Modal -->
  <div class="modal" id="accountModal">
    <div class="modal-content extra-large">
      <div class="modal-body" id="accountModalContent">
        <!-- Content will be injected by JavaScript -->
      </div>
    </div>
  </div>

  <!-- Message Notification -->
  <div class="message-container" id="messageContainer"></div>

  <script type="module" src="FlaggedAccounts.js"></script>
</body>
</html>
